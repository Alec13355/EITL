---
// This component handles the Copilot Adoption Checklist form
// It submits to HubSpot and then triggers a file download
//
// SETUP INSTRUCTIONS:
// 1. Create a form in HubSpot (Marketing > Lead Capture > Forms)
// 2. Add fields: First Name, Last Name, Email
// 3. Get your HubSpot Portal ID (found in Settings > Account Setup > Account Defaults)
// 4. Get your Form GUID (found in the form's embed code or API)
// 5. Add these environment variables to your .env file:
//    PUBLIC_HUBSPOT_PORTAL_ID=your_portal_id
//    PUBLIC_HUBSPOT_FORM_GUID=your_form_guid
//
// Note: If HubSpot isn't configured, the form will still work and download the file,
// but won't submit data to HubSpot.
---

<div class="bg-tealbg rounded-lg shadow-sm p-6 border border-accent/30">
	<h2 class="text-2xl font-bold text-sand mb-4">Get My Copilot Adoption Checklist</h2>
	<p class="text-sand/80 mb-6">
		Download a comprehensive checklist to guide your Microsoft Copilot implementation. 
		Get step-by-step guidance for planning, piloting, and rolling out Copilot across your organization.
	</p>
	
	<form id="copilot-checklist-form" class="space-y-4">
		<div>
			<label for="name" class="block text-sm font-medium text-sand mb-1">Name</label>
			<input 
				type="text" 
				id="name" 
				name="name" 
				required 
				class="w-full px-4 py-2 border border-accent/30 rounded-md bg-white text-gray-900 focus:ring-2 focus:ring-accent focus:border-accent"
				placeholder="Your name"
			/>
		</div>
		<div>
			<label for="email" class="block text-sm font-medium text-sand mb-1">Email</label>
			<input 
				type="email" 
				id="email" 
				name="email" 
				required 
				class="w-full px-4 py-2 border border-accent/30 rounded-md bg-white text-gray-900 focus:ring-2 focus:ring-accent focus:border-accent"
				placeholder="your.email@example.com"
			/>
		</div>
		<button 
			type="submit" 
			id="submit-btn"
			class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-tealbg bg-accent hover:bg-accent/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
		>
			<span id="submit-text">Download Checklist</span>
			<span id="submit-loading" class="hidden ml-2">
				<svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
					<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
					<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
				</svg>
			</span>
		</button>
		<div id="error-message" class="hidden text-red-500 text-sm mt-2"></div>
		<div id="success-message" class="hidden text-green-500 text-sm mt-2"></div>
	</form>
</div>

<script>
	// HubSpot configuration - replace with your HubSpot portal ID
	// You can find this in your HubSpot account settings
	const HUBSPOT_PORTAL_ID = 244360500;
	const HUBSPOT_FORM_GUID = 'ab400a92-2183-4a3c-94e1-8ddda3abb73c';
	
	// If using HubSpot Forms API v3, you'll need an API key
	// For public forms, you can use the embedded form approach or Forms API
	const HUBSPOT_API_KEY = 'pat-na2-04c6fc96-5130-43f5-9e5a-38246c925b67';

	const form = document.getElementById('copilot-checklist-form') as HTMLFormElement;
	const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
	const submitText = document.getElementById('submit-text') as HTMLSpanElement;
	const submitLoading = document.getElementById('submit-loading') as HTMLSpanElement;
	const errorMessage = document.getElementById('error-message') as HTMLDivElement;
	const successMessage = document.getElementById('success-message') as HTMLDivElement;

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		
		const nameInput = document.getElementById('name') as HTMLInputElement;
		const emailInput = document.getElementById('email') as HTMLInputElement;
		
		const name = nameInput.value.trim();
		const email = emailInput.value.trim();
		
		// Hide previous messages
		errorMessage.classList.add('hidden');
		successMessage.classList.add('hidden');
		
		// Show loading state
		submitBtn.disabled = true;
		submitText.textContent = 'Submitting...';
		submitLoading.classList.remove('hidden');
		
		try {
			// Submit to HubSpot
			if (HUBSPOT_PORTAL_ID && HUBSPOT_FORM_GUID) {
				// Using HubSpot Forms API v3
				const hubspotUrl = `https://api.hsforms.com/submissions/v3/integration/submit/${HUBSPOT_PORTAL_ID}/${HUBSPOT_FORM_GUID}`;
				
				const formData = {
					fields: [
						{
							objectTypeId: '0-1',
							name: 'firstname',
							value: name.split(' ')[0] || name
						},
						{
							objectTypeId: '0-1',
							name: 'lastname',
							value: name.split(' ').slice(1).join(' ') || ''
						},
						{
							objectTypeId: '0-1',
							name: 'email',
							value: email
						}
					],
					context: {
						pageUri: window.location.href,
						pageName: document.title
					}
				};
				
				const response = await fetch(hubspotUrl, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(formData)
				});
				
				if (!response.ok) {
					throw new Error('Failed to submit to HubSpot');
				}
			} else {
				// Fallback: If HubSpot isn't configured, we'll still allow download
				// You might want to log this to a service like Formspree, Netlify Forms, etc.
				console.warn('HubSpot not configured, skipping form submission');
			}
			
			// Show success message
			successMessage.textContent = 'Thank you! Downloading your checklist...';
			successMessage.classList.remove('hidden');
			
			// Trigger file download
			const link = document.createElement('a');
			link.href = '/copilot-adoption-checklist.md';
			link.download = 'copilot-adoption-checklist.md';
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			
			// Reset form after a short delay
			setTimeout(() => {
				form.reset();
				successMessage.classList.add('hidden');
			}, 3000);
			
		} catch (error) {
			console.error('Error submitting form:', error);
			errorMessage.textContent = 'There was an error submitting your information. Please try again.';
			errorMessage.classList.remove('hidden');
		} finally {
			// Reset button state
			submitBtn.disabled = false;
			submitText.textContent = 'Download Checklist';
			submitLoading.classList.add('hidden');
		}
	});
</script>

